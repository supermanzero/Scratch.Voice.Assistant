<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scratch 教程语音助手</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="popup-container">
    <header class="popup-header">
      <div class="logo">
        <img class="logo-icon" src="https://img.icons8.com/fluency/24/voice-presentation.png" alt="语音助手" onerror="this.style.display='none'">
        <h1>Scratch 教学助手</h1>
      </div>
      <div class="version">v1.0.0</div>
    </header>

    <!-- 授权验证界面 -->
    <div class="license-required" id="licenseRequired" style="display: none;">
      <div class="license-modal">
        <div class="license-header">
          <h2>🔑 授权验证</h2>
          <p>请输入授权码以使用 Scratch 教学助手</p>
        </div>
        
        <div class="license-form">
          <div class="form-group">
            <label for="licenseCodeInput">授权码:</label>
            <input type="text" id="licenseCodeInput" placeholder="请输入授权码" maxlength="50">
          </div>
          
          <div class="device-info">
            <div class="device-uuid">
              <span class="label">设备ID:</span>
              <span class="value" id="deviceUuid">获取中...</span>
            </div>
          </div>
          
          <div class="license-actions">
            <button class="btn-primary" id="validateLicenseBtn">验证授权码</button>
            <button class="btn-secondary" id="clearLicenseBtn">清除授权</button>
          </div>
          
          <div class="license-message" id="licenseMessage" style="display: none;"></div>
        </div>
        
        <div class="license-footer">
          <p class="help-text">如果您没有授权码，请联系管理员获取</p>
        </div>
      </div>
    </div>

    <main class="popup-main">
      <div class="status-section">
        <div class="status-item">
          <span class="status-label">状态</span>
          <span class="status-value" id="connectionStatus">检查中...</span>
        </div>
        <div class="status-item">
          <span class="status-label">当前页面</span>
          <span class="status-value" id="currentPage">未知</span>
        </div>
      </div>

      <div class="quick-actions">
        <h3>快速操作</h3>
        <div class="action-buttons">
          <button class="action-btn primary" id="openScratchBtn">
            <img class="btn-icon" src="https://img.icons8.com/ios-glyphs/16/external-link.png" alt="打开" onerror="this.style.display='none'">
            打开 Scratch 编辑器
          </button>
          
          <button class="action-btn secondary" id="toggleAssistantBtn">
            <img class="btn-icon" src="https://img.icons8.com/ios-glyphs/16/visible--v1.png" alt="显示" onerror="this.style.display='none'">
            显示/隐藏助手
          </button>
        </div>
      </div>

      <div class="packages-section">
        <h3>课程套餐</h3>
        <div class="package-list" id="packageList">
          <!-- 套餐列表将通过JavaScript动态生成 -->
          <div class="loading-packages">
            <div class="loading-spinner"></div>
            <p>正在加载套餐...</p>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <h3>设置</h3>
        <div class="setting-item">
          <label class="setting-label">
            <input type="checkbox" id="autoPlaySetting">
            <span class="checkmark"></span>
            自动播放下一步
          </label>
        </div>
        <div class="setting-item">
          <label class="setting-label">
            <input type="checkbox" id="highlightSetting" checked>
            <span class="checkmark"></span>
            高亮显示相关积木
          </label>
        </div>

        <div class="setting-item" style="display: none;">
          <span class="setting-text">语音引擎</span>
          <select class="setting-select" id="voiceEngineSetting">
            <option value="browser">浏览器TTS</option>
            <option value="google">Google TTS</option>
            <option value="baidu" selected>百度TTS</option>
            <option value="youdao">有道TTS</option>
          </select>
        </div>
        <div class="setting-item" style="display: none;">
          <span class="setting-text">语音选择</span>
          <select class="setting-select" id="voiceSelectSetting">
            <option value="baidu-4140">度小新 (专业女主播)</option>
          </select>
        </div>
        <div class="setting-item" style="display: none;">
          <span class="setting-text">语音语言</span>
          <select class="setting-select" id="languageSetting">
            <option value="zh-CN" selected>中文</option>
            <option value="en-US">English</option>
          </select>
        </div>
        <div class="setting-item">
          <span class="setting-text">语音速度</span>
          <div class="slider-container">
            <input type="range" class="setting-slider" id="speechRateSetting" min="0.5" max="2" step="0.1" value="1">
            <span class="slider-value" id="speechRateValue">1.0x</span>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-text">音量</span>
          <div class="slider-container">
            <input type="range" class="setting-slider" id="speechVolumeSetting" min="0" max="1" step="0.1" value="0.8">
            <span class="slider-value" id="speechVolumeValue">80%</span>
          </div>
        </div>
        <div class="setting-item" style="display: none;">
          <button class="test-voice-btn" id="testVoiceBtn">
            <img class="btn-icon" src="https://img.icons8.com/ios-glyphs/16/play.png" alt="测试" onerror="this.style.display='none'">
            测试语音
          </button>
        </div>
        
        <!-- 代理服务器配置 -->
        <div class="setting-group">
          <h4 class="setting-group-title">代理服务器配置</h4>
          <div class="setting-item">
            <label class="setting-label">
              <input type="checkbox" id="proxyEnabledSetting" checked>
              <span class="checkmark"></span>
              启用代理服务器
            </label>
          </div>
          <div class="setting-item">
            <span class="setting-text">代理服务器地址</span>
            <input type="text" class="setting-input" id="proxyBaseUrlSetting" value="http://localhost:8000" placeholder="http://localhost:8000">
          </div>
          <div class="setting-item">
            <span class="setting-text">超时时间(毫秒)</span>
            <input type="number" class="setting-input" id="proxyTimeoutSetting" value="10000" min="1000" max="60000" step="1000">
          </div>
        </div>
        <div class="setting-item">
          <button class="sync-firebase-btn" id="syncFirebaseBtn">
            <img class="btn-icon" src="https://img.icons8.com/?size=100&id=l55Giv1YHgNO&format=png&color=000000" alt="同步" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTggMkM0LjY4NjI5IDIgMiA0LjY4NjI5IDIgOFM0LjY4NjI5IDE0IDggMTRTMTQgMTEuMzEzNyAxNCA4UzExLjMxMzcgMiA4IDJaTTggMTJDNS43OTE0NCAxMiA0IDEwLjIwODUgNCA4UzUuNzkxNDQgNCA4IDRTMTIgNS43OTE0NCAxMiA4UzEwLjIwODUgMTIgOCAxMloiIGZpbGw9IiMwMDc3RkYiLz4KPHBhdGggZD0iTTggNlYxMEw2IDhIOFY2WiIgZmlsbD0iIzAwNzdGRiIvPgo8L3N2Zz4K'; this.onerror=null;">
            同步教程到Firebase
          </button>
        </div>
      </div>
    </main>

    <footer class="popup-footer">
      <div class="footer-links">
        <a href="#" id="helpLink">帮助</a>
        <a href="#" id="feedbackLink">反馈</a>
        <a href="#" id="aboutLink">关于</a>
        <a href="#" id="debugBtn" style="color: #666; font-size: 11px;">调试</a>
      </div>
    </footer>
  </div>

  <script src="popup.js"></script>
</body>
</html>